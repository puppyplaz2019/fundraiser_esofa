<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ESOFA Harmony: Sanco Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: #fdf5e6; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        .panel { position: absolute; background: rgba(255, 255, 255, 0.05); border: 1px solid #d4af37; border-radius: 4px; padding: 12px; z-index: 10; pointer-events: none; }
        #stats { top: 20px; left: 20px; text-align: center; }
        #score { font-size: 28px; color: #d4af37; font-weight: bold; }
        #next-preview { bottom: 20px; left: 20px; text-align: center; }
        #next-icon { font-size: 40px; display: block; margin-top: 5px; }

        /* Unified Support Menu */
        #donation-modal {
            position: absolute; display: none; flex-direction: column; align-items: center;
            background: #252525; padding: 30px; border: 2px solid #d4af37; border-radius: 8px;
            z-index: 1000; width: 340px; text-align: center; box-shadow: 0 0 40px rgba(0,0,0,0.8);
        }
        .hub-link { width: 100%; padding: 14px; margin: 8px 0; font-weight: bold; text-decoration: none; border-radius: 4px; display: block; transition: 0.2s; }
        .hub-link:hover { transform: scale(1.02); }
        
        .yt-btn { background: #ff0000; color: white; border: 1px solid white; }
        .tip-btn { background: #d4af37; color: #1a1a1a; }

        .btn { position: absolute; cursor: pointer; padding: 12px 24px; border: none; font-weight: bold; border-radius: 4px; z-index: 100; background: #d4af37; color: #1a1a1a; }
        #menu-trigger { bottom: 20px; right: 20px; }
        canvas { border: 2px solid #333; border-bottom: 5px solid #d4af37; background: #141414; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="stats" class="panel">
        <div style="font-size: 10px; letter-spacing: 2px;">SCORE</div>
        <div id="score">0</div>
    </div>

    <div id="next-preview" class="panel">
        <div style="font-size: 10px; letter-spacing: 2px;">UPCOMING</div>
        <span id="next-icon">ðŸªˆ</span>
    </div>

    <div id="donation-modal">
        <h3 style="color:#d4af37; margin-top:0; letter-spacing: 2px;">COMMUNITY HUB</h3>
        
        <a class="hub-link yt-btn" href="https://www.youtube.com/@SancoOutdoors" target="_blank">ðŸŽ¬ SUB TO SANCO OUTDOORS</a>
        <a class="hub-link tip-btn" href="https://www.sanangelogives.org/organization/emmanuelschooloffinearts" target="_blank">ðŸŽ» TIP THE SCHOOL</a>
        
        <div style="margin-top:20px; color:#888; cursor:pointer; font-size: 12px;" onclick="toggleModal(false)">[ RETURN TO GAME ]</div>
    </div>

    <button id="menu-trigger" class="btn" onclick="toggleModal(true)">SUPPORT HUB</button>
</div>

<script>
    const { Engine, Render, Runner, Bodies, Composite, Events } = Matter;
    const engine = Engine.create();
    const width = 400, height = 600;

    const render = Render.create({
        element: document.getElementById('game-container'),
        engine: engine,
        options: { width, height, wireframes: false, background: 'transparent' }
    });

    const ORBS = [
        { r: 25, icon: 'ðŸŽµ', pts: 10, color: '#f5deb3' },
        { r: 35, icon: 'ðŸªˆ', pts: 20, color: '#98fb98' },
        { r: 45, icon: 'ðŸŽº', pts: 40, color: '#ffb347' },
        { r: 55, icon: 'ðŸŽ·', pts: 80, color: '#ff6961' },
        { r: 70, icon: 'ðŸŽ»', pts: 150, color: '#b19cd9' }
    ];

    const ground = Bodies.rectangle(200, 610, 400, 60, { isStatic: true });
    const leftWall = Bodies.rectangle(-10, 300, 20, 600, { isStatic: true });
    const rightWall = Bodies.rectangle(410, 300, 20, 600, { isStatic: true });
    Composite.add(engine.world, [ground, leftWall, rightWall]);

    let score = 0, currentIdx = 0, nextIdx = Math.floor(Math.random() * 3), canDrop = true, mouseX = 200, modalOpen = false;
    document.getElementById('next-icon').innerText = ORBS[nextIdx].icon;

    function toggleModal(show) { 
        modalOpen = show; 
        document.getElementById('donation-modal').style.display = show ? 'flex' : 'none'; 
    }

    function drop() {
        if(!canDrop || modalOpen) return;
        canDrop = false;
        const ball = Bodies.circle(mouseX, 50, ORBS[currentIdx].r, {
            restitution: 0.4,
            plugin: { icon: ORBS[currentIdx].icon, r: ORBS[currentIdx].r, idx: currentIdx, color: ORBS[currentIdx].color }
        });
        Composite.add(engine.world, ball);
        currentIdx = nextIdx;
        nextIdx = Math.floor(Math.random() * 3);
        document.getElementById('next-icon').innerText = ORBS[nextIdx].icon;
        setTimeout(() => { canDrop = true; }, 500);
    }

    render.canvas.addEventListener('mousemove', (e) => {
        const rect = render.canvas.getBoundingClientRect();
        mouseX = Math.max(25, Math.min(375, e.clientX - rect.left));
    });

    render.canvas.addEventListener('mousedown', drop);
    window.addEventListener('keydown', (e) => { if(e.code === 'Space') drop(); });

    Events.on(engine, 'collisionStart', (event) => {
        event.pairs.forEach(pair => {
            const a = pair.bodyA; const b = pair.bodyB;
            if(a.plugin.idx !== undefined && a.plugin.idx === b.plugin.idx) {
                const idx = a.plugin.idx;
                if(idx < ORBS.length - 1) {
                    const newX = (a.position.x + b.position.x) / 2;
                    const newY = (a.position.y + b.position.y) / 2;
                    Composite.remove(engine.world, [a, b]);
                    const upgraded = Bodies.circle(newX, newY, ORBS[idx+1].r, {
                        plugin: { icon: ORBS[idx+1].icon, r: ORBS[idx+1].r, idx: idx+1, color: ORBS[idx+1].color }
                    });
                    Composite.add(engine.world, upgraded);
                    score += ORBS[idx+1].pts;
                    document.getElementById('score').innerText = score;
                }
            }
        });
    });

    Events.on(render, 'afterRender', () => {
        const ctx = render.context;
        if(canDrop && !modalOpen) {
            ctx.globalAlpha = 0.5;
            ctx.font = "30px serif";
            ctx.textAlign = "center";
            ctx.fillText(ORBS[currentIdx].icon, mouseX, 50);
            ctx.globalAlpha = 1;
        }
        engine.world.bodies.forEach(body => {
            if(body.plugin.icon) {
                ctx.save();
                ctx.translate(body.position.x, body.position.y);
                ctx.rotate(body.angle);
                ctx.beginPath();
                ctx.arc(0, 0, body.plugin.r, 0, Math.PI*2);
                ctx.fillStyle = body.plugin.color;
                ctx.fill();
                ctx.font = `${body.plugin.r}px serif`;
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                ctx.fillStyle = "#1a1a1a";
                ctx.fillText(body.plugin.icon, 0, 0);
                ctx.restore();
            }
        });
    });

    Render.run(render);
    Runner.run(Runner.create(), engine);
</script>
</body>
</html>
